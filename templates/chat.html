{% extends "base.html" %}

{% block title %}Chat - GoldenDoodleLM{% endblock %}

{% block head %}
<style>
.chat-container {
    height: calc(100vh - 200px);
    display: flex;
    flex-direction: column;
}

.chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 1rem;
    background: #f8f9fa;
}

.message {
    margin-bottom: 1rem;
}

.message-user {
    text-align: right;
}

.message-bubble {
    display: inline-block;
    max-width: 70%;
    padding: 0.75rem 1rem;
    border-radius: 1rem;
    word-wrap: break-word;
}

.message-user .message-bubble {
    background: #007bff;
    color: white;
}

.message-ai .message-bubble {
    background: white;
    border: 1px solid #dee2e6;
    color: #333;
}

.content-modes {
    padding: 1rem;
    background: white;
    border-top: 1px solid #dee2e6;
}

.mode-btn {
    margin: 0.25rem;
    border: 1px solid #dee2e6;
    background: white;
    color: #6c757d;
    transition: all 0.2s;
}

.mode-btn:hover {
    border-color: #007bff;
    color: #007bff;
}

.mode-btn.active {
    background: #007bff;
    border-color: #007bff;
    color: white;
}

.chat-input-area {
    padding: 1rem;
    background: white;
    border-top: 1px solid #dee2e6;
}

.brand-voice-selector {
    margin-bottom: 1rem;
}

#chatInput {
    min-height: 80px;
    resize: none;
}

.loading-dots {
    display: inline-block;
}

.loading-dots::after {
    content: '';
    animation: dots 1.5s infinite;
}

@keyframes dots {
    0%, 20% { content: ''; }
    40% { content: '.'; }
    60% { content: '..'; }
    80%, 100% { content: '...'; }
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="chat-container">
                <!-- Chat Messages Area -->
                <div class="chat-messages" id="chatMessages">
                    <div class="text-center py-5">
                        <i class="fas fa-heart text-primary mb-3" style="font-size: 3rem;"></i>
                        <h4 class="text-primary mb-2">Welcome to GoldenDoodleLM</h4>
                        <p class="text-muted">Your empathetic, trauma-informed AI assistant is here to help create meaningful communications.</p>
                        <p class="text-muted"><small>Choose a content mode below and start your conversation.</small></p>
                    </div>
                </div>
                
                <!-- Content Modes -->
                <div class="content-modes">
                    <div class="row g-2">
                        <div class="col-auto">
                            <small class="text-muted fw-semibold">Content Modes:</small>
                        </div>
                    </div>
                    <div class="row g-2 mt-1">
                        <!-- Primary Row -->
                        <div class="col-auto">
                            <button class="btn btn-sm mode-btn" data-mode="email" data-temp="0.5">
                                <i class="fas fa-envelope me-1"></i>Email
                            </button>
                        </div>
                        <div class="col-auto">
                            <button class="btn btn-sm mode-btn" data-mode="article" data-temp="0.7">
                                <i class="fas fa-newspaper me-1"></i>Article
                            </button>
                        </div>
                        <div class="col-auto">
                            <button class="btn btn-sm mode-btn" data-mode="social_media" data-temp="0.8">
                                <i class="fas fa-share-alt me-1"></i>Social Media
                            </button>
                        </div>
                        <div class="col-auto">
                            <button class="btn btn-sm mode-btn" data-mode="rewrite" data-temp="0.4">
                                <i class="fas fa-edit me-1"></i>Rewrite
                            </button>
                        </div>
                        <div class="col-auto">
                            <button class="btn btn-sm btn-outline-secondary" id="moreModesBtn">
                                <i class="fas fa-ellipsis-h me-1"></i>More
                            </button>
                        </div>
                    </div>
                    
                    <!-- Secondary Row (Hidden by default) -->
                    <div class="row g-2 mt-1" id="secondaryModes" style="display: none;">
                        <div class="col-auto">
                            <button class="btn btn-sm mode-btn" data-mode="summarize" data-temp="0.3">
                                <i class="fas fa-compress-alt me-1"></i>Summarize
                            </button>
                        </div>
                        <div class="col-auto">
                            <button class="btn btn-sm mode-btn" data-mode="brainstorm" data-temp="0.9">
                                <i class="fas fa-lightbulb me-1"></i>Brainstorm
                            </button>
                        </div>
                        <div class="col-auto">
                            <button class="btn btn-sm mode-btn" data-mode="analyze" data-temp="0.4">
                                <i class="fas fa-chart-line me-1"></i>Analyze
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Chat Input Area -->
                <div class="chat-input-area">
                    <!-- Brand Voice Selector -->
                    <div class="brand-voice-selector">
                        <div class="row align-items-center">
                            <div class="col-auto">
                                <small class="text-muted fw-semibold">Brand Voice:</small>
                            </div>
                            <div class="col">
                                <select class="form-select form-select-sm" id="brandVoiceSelect">
                                    <option value="">Neutral (No brand voice)</option>
                                    {% if company_brand_voices %}
                                    <optgroup label="Company Brand Voices">
                                        {% for voice in company_brand_voices %}
                                        <option value="{{ voice.brand_voice_id }}">{{ voice.name }} (Company)</option>
                                        {% endfor %}
                                    </optgroup>
                                    {% endif %}
                                    {% if user_brand_voices %}
                                    <optgroup label="Personal Brand Voices">
                                        {% for voice in user_brand_voices %}
                                        <option value="{{ voice.brand_voice_id }}">{{ voice.name }} (Personal)</option>
                                        {% endfor %}
                                    </optgroup>
                                    {% endif %}
                                </select>
                            </div>
                            <div class="col-auto">
                                <a href="{{ url_for('brand_voices') }}" class="btn btn-outline-primary btn-sm">
                                    <i class="fas fa-plus me-1"></i>Manage
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Chat Input -->
                    <div class="row g-2">
                        <div class="col">
                            <textarea class="form-control" id="chatInput" 
                                    placeholder="How can I help you create trauma-informed content today?" 
                                    rows="3"></textarea>
                        </div>
                        <div class="col-auto align-self-end">
                            <button class="btn btn-primary" id="sendBtn">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/chat.js') }}"></script>
{% endblock %}
